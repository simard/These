\NeedsTeXFormat{LaTeX2e}[1999/01/01]
\ProvidesPackage{mydate}[2011/03/28]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Declare package options %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Language options
\newif\if@english \@englishfalse
\DeclareOption{english}{\@englishtrue}
\newif\if@francais \@francaisfalse
\DeclareOption{francais}{\@francaistrue}
% In case of unknown options
\DeclareOption*{%
	\PackageWarning{mydate}{Unknown option `\CurrentOption'}%
}

\ProcessOptions

%% Options to pass to packages
\PassOptionsToPackage{french}{datenumber}
\if@francais
	\PassOptionsToPackage{french}{datenumber}
\fi
\if@english
	\PassOptionsToPackage{english}{datenumber}
\fi

%% Packages to call
\RequirePackage{xifthen}
\RequirePackage{xkeyval}
\RequirePackage{xspace}
\RequirePackage{datenumber}

%%%%%%%%%%%%%%%%%%
%% New commands %%
%%%%%%%%%%%%%%%%%%
%% Define a key about the style
% The styles should be one of the following value:
% - resume -> 28/03/2011
% - short -> 28th march 2011
% - long -> monday, 28th march 2011
\define@key[my]{date}{datestyle}[short]{\def\my@date@datestyle{#1}}
%% Define a key about the separator in a 'resume' style date
\define@key[my]{date}{datesep}[-]{\def\my@date@datesep{#1}}
\setkeys[my]{date}{datesep={-}}
%% Command \Date insere a date with different styles
\newcommand{\mydate}[4][]{%
	\setkeys[my]{date}{#1}%
	\ifthenelse{\equal{\my@date@datestyle}{resume}}%
		{#2\my@date@datesep{}#3\my@date@datesep{}#4\xspace}%
		{%
			\setdatenumber{#4}{#3}{#2}%
			\ifthenelse{\equal{\my@date@datestyle}{short}}%
				{\datedate\xspace}%
				{%
					\ifthenelse{\equal{\my@date@datestyle}{long}}%
					{\datedayname\ \datedate\xspace}%
					{\PackageError{mydate}{Unknown option `\my@date@datestyle' for `datestyle' in `\\mydate'.}{You must use `resume', `short' or `long' option.}}%
				}
		}
	}
% End of package
\endinput
