\NeedsTeXFormat{LaTeX2e}[1999/01/01]
\ProvidesPackage{myglossary}[2011/04/29]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Declare package options %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Language options
\newif\if@myenglish \@myenglishfalse
\DeclareOption{myenglish}{\@myenglishtrue}
\newif\if@myfrancais \@myfrancaisfalse
\DeclareOption{myfrancais}{\@myfrancaistrue}
% To have smart reference with 'varioref' package
\newif\if@acronym \@acronymfalse
\DeclareOption{acronym}{\@acronymtrue}
% In case of unknown options
\DeclareOption*{%
	\PackageWarning{myglossary}{Unknown option `\CurrentOption'}%
}

\ProcessOptions

%% Options to pass to packages
\if@myenglish
	\PassOptionsToPackage{english}{translator}
	\PassOptionsToPackage{xindy={language=english,codepage=utf8}}{glossaries}
\fi
\if@myfrancais
	\PassOptionsToPackage{french}{translator}
	\PassOptionsToPackage{xindy={language=french,codepage=utf8}}{glossaries}
\fi
\if@acronym
	% To add the acronym glossary
	\PassOptionsToPackage{acronym=true}{glossaries}
\fi

%% Packages to call
% To obtain the '\AtEndPreamble' command
\RequirePackage{etoolbox}
% The 'suffix' package offers the '\WithSuffix' command to define starred commands
\RequirePackage{suffix}
% To translate titles in 'glossaries' package
\RequirePackage{translator}
% To improve the glossary
\RequirePackage[toc=true,style=altlist]{glossaries}
% Improve the bookmarks in the PDF
\RequirePackage[dvips]{bookmark}

%%%%%%%%%%%%%%%%%%%%%%%
%% New configuration %%
%%%%%%%%%%%%%%%%%%%%%%%
\AtEndPreamble{\makeglossaries}

%%%%%%%%%%%%%%%%%%
%% New commands %%
%%%%%%%%%%%%%%%%%%
%% Define the command to display the glossary at the end of document
\newrobustcmd\myglossary{%
	\bookmark[level=0]{}%
	\printglossaries%
}
%% To create a new glossary entry
% Following options are allowed:
% - name: the name (text which will appeared in document)
% - description: description of the word in the glossary
% - plural: how it should be in plural context
\newrobustcmd\mynewglos[2]{\newglossaryentry{#1}{sort={#1},#2}}
\if@acronym
	%% To create a new acronym entry
	% All options from '\mynewglos' are allowed and some others:
	% - first: displayed text the first time in the document
	% - firstplural: displayed text the first time in the document (plural context)
	\newrobustcmd\mynewacro[2]{\newglossaryentry{#1}{type=\acronymtype,sort={#1},#2}}
\fi
%% To insert a glossary item in the text
% Three different suffix are allowed:
% - '-' to be sure to have the shorter one (not the first, useful for acronyms)
% - '+' to be sure to have the longer one (the first, useful for acronyms)
% - '*' to have the plural form
\def\mycustomglos#1#2{
	% With hyperlink
	\expandafter\newrobustcmd\csname my#1\endcsname[1]{\protect\csname #2\endcsname{##1}}
	\WithSuffix\expandafter\newrobustcmd\csname my#1\endcsname-[1]{\protect\csname #2text\endcsname{##1}}
	\WithSuffix\expandafter\newrobustcmd\csname my#1\endcsname+[1]{\protect\csname #2first\endcsname{##1}}
	\WithSuffix\expandafter\newrobustcmd\csname my#1\endcsname*[1]{\protect\csname #2pl\endcsname{##1}}
	% With no hyperlink
	\expandafter\newrobustcmd\csname my#1nl\endcsname[1]{\protect\csname #2\endcsname*{##1}}
	\WithSuffix\expandafter\newrobustcmd\csname my#1nl\endcsname-[1]{\protect\csname #2text\endcsname*{##1}}
	\WithSuffix\expandafter\newrobustcmd\csname my#1nl\endcsname+[1]{\protect\csname #2first\endcsname*{##1}}
	\WithSuffix\expandafter\newrobustcmd\csname my#1nl\endcsname*[1]{\protect\csname #2pl\endcsname*{##1}}
}
\mycustomglos{glos}{gls}
\mycustomglos{Glos}{Gls}
\mycustomglos{GLOS}{GLS}
\if@acronym
	\mycustomglos{acro}{gls}
	\mycustomglos{Acro}{Gls}
	\mycustomglos{ACRO}{GLS}
\fi

% End of package
\endinput
