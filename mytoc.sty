\NeedsTeXFormat{LaTeX2e}[1999/01/01]
\ProvidesPackage{mytoc}[2011/03/28]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Declare package options %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Language options
\newif\if@english \@englishfalse
\DeclareOption{english}{\@englishtrue}
\newif\if@francais \@francaisfalse
\DeclareOption{francais}{\@francaistrue}
% What is the section level for the table of contents
\newif\if@chapter \@chapterfalse
\DeclareOption{chapter}{\@chaptertrue}
\newif\if@section \@sectionfalse
\DeclareOption{section}{\@sectiontrue}
% For the intermediate table of contents
\newif\if@minitoc \@minitocfalse
\DeclareOption{minitoc}{\@minitoctrue}
% In case of unknown options
\DeclareOption*{%
	\PackageWarning{mytoc}{Unknown option `\CurrentOption'}%
}

\ProcessOptions

%% Options to pass to packages
\if@minitoc
	\PassOptionsToPackage{francais}{minitoc}
	\if@francais
		\PassOptionsToPackage{francais}{minitoc}
	\fi
	\if@english
		\PassOptionsToPackage{english}{minitoc}
	\fi
\fi

%% Packages to call
% Improve link for bibliographies and other titles
\RequirePackage{tocbibind}
% Improve the support for appendices
\RequirePackage{appendix}
\if@minitoc
	% To make small table of contents at the beginning of each section
	\RequirePackage{minitoc}
\fi

%%%%%%%%%%%%%%%%%%%%%%%
%% New configuration %%
%%%%%%%%%%%%%%%%%%%%%%%
% Redefine names depending on language
\if@myfrancais
	\renewcommand{\appendixpagename}{Annexes}
	\renewcommand{\appendixtocname}{Annexes}
\fi
% Add page number for appendices
\appendicestocpagenum
\if@minitoc
	% Redefine the default style for minitoc
	\mtcsettitlefont{minitoc}{\large\bfseries\sffamily}
	% Necessary command to create minitoc (before the preamble)
	\AtBeginDocument{\dominitoc}
\fi

%%%%%%%%%%%%%%%%%%
%% New commands %%
%%%%%%%%%%%%%%%%%%
% Define the appendix command
\newcommand{\myappendix}{%
	\appendixpage%
	\cleardoublepage%
	\appendix%
	\addappheadtotoc%
}
% Define the table of contents command,
% and add the title in the table of contents
\newcommand{\mytoc}{%
	\tableofcontents%
	% To make compatibility between 'minitoc' and 'tocbibind'
	\mtcaddchapter%
}
% Define the list of figures command,
% and add the title in the table of contents
\newcommand{\mylof}{%
	\listoffigures%
	% To make compatibility between 'minitoc' and 'tocbibind'
	\mtcaddchapter%
}
% Define the list of tables command,
% and add the title in the table of contents
\newcommand{\mylot}{%
	\listoftables%
	% To make compatibility between 'minitoc' and 'tocbibind'
	\mtcaddchapter%
}
\if@minitoc
	\newcommand{\myminitoc}{\minitoc}
\fi
\newenvironment{mypart}[2][par-??]{%
	\def\my@args@one{#1}%
	\def\my@args@two{#2}%
	\part{\my@args@two}\label{\my@args@one}%%
}{}
\newenvironment{mychapter}[2][cha-??]{%
	\def\my@args@one{#1}%
	\def\my@args@two{#2}%
	\chapter{\my@args@two}\label{\my@args@one}%
	\if@minitoc%
		\myminitoc%
	\fi%
}{}
\newenvironment{mysection}[2][sec-??]{%
	\def\my@args@one{#1}%
	\def\my@args@two{#2}%
	\section{\my@args@two}\label{\my@args@one}%
}{}
\newenvironment{mysubsection}[2][sse-??]{%
	\def\my@args@one{#1}%
	\def\my@args@two{#2}%
	\subsection{\my@args@two}\label{\my@args@one}%
}{}
\newenvironment{mysubsubsection}[2][sss-??]{%
	\def\my@args@one{#1}%
	\def\my@args@two{#2}%
	\subsubsection{\my@args@two}\label{\my@args@one}%
}{}
\newenvironment{myparagraph}[2][par-??]{%
	\def\my@args@one{#1}%
	\def\my@args@two{#2}%
	\paragraph{\my@args@two}\label{\my@args@one}%
}{}
\newenvironment{mysubparagraph}[2][par-??]{%
	\def\my@args@one{#1}%
	\def\my@args@two{#2}%
	\subparagraph{\my@args@two}\label{\my@args@one}%
}{}

% End of package
\endinput
